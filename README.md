# 装运清单处理工具

## 简介
这个工具用于处理装运清单数据，计算FOB和CIF价格，并生成出口和复进口发票。根据原始装箱单和政策参数，自动计算FOB价格、运费、保险费以及最终的CIF价格。

## 功能特点
- 读取原始装箱单和政策参数Excel文件
- 自动计算FOB价格 (基于加价率)
- 计算保险费 (基于保险系数和保险费率)
- 计算运费 (基于总运费和物料重量)
- 计算最终CIF价格
- 支持按工厂拆分生成复进口发票
- 美观的Excel格式，包括表头样式、数字格式和合计行

## 使用方法

### 准备文件
1. 将原始装箱单Excel文件放在`testfiles`目录下，命名为`original_packing_list.xlsx`
2. 将政策参数Excel文件放在`testfiles`目录下，命名为`policy.xlsx`

### 政策文件格式
政策文件需要包含以下参数:
- `加价率`: FOB计算的加价百分比
- `保险系数`: 保险费计算的系数
- `保险费率`: 保险费率
- `总运费(RMB)`: 总运费金额（人民币）
- `汇率(RMB/美元)`: 人民币兑美元汇率

### 运行程序
1. 确保已安装Python和必要的依赖包：
   ```
   pip install pandas openpyxl
   ```
2. 运行处理脚本：
   ```
   python process_shipping_list.py
   ```
3. 检查`outputs`目录中生成的文件：
   - `export_invoice.xlsx`: 完整的出口发票
   - `reimport_invoice_factory_*.xlsx`: 按工厂拆分的复进口发票

## 输出文件说明
生成的Excel文件包含以下主要列：
- 物料基本信息（料号、描述、型号等）
- 采购价格信息（采购单价、采购总价）
- FOB价格信息（FOB单价、FOB总价）
- 运费和保险费计算（每公斤摊的运保费、该项对应的运保费）
- CIF价格信息（CIF总价、CIF单价）
- 美元价格（单价USD数值）
- 其他辅助信息（工厂、项目、用途等）

## 工作流程图
详细的工作流程请参考`WORKFLOW-CN.md`文件，其中包含了详细的流程图和计算逻辑说明。

## 常见问题
1. **如果Excel文件编码有问题怎么办？**  
   确保Excel文件使用UTF-8编码保存，或者在程序中添加相应的编码参数。

2. **如何修改列的顺序？**  
   在`process_shipping_list.py`文件中的`output_columns`列表中调整列的顺序。

3. **如何自定义Excel样式？**  
   修改`apply_excel_styling`函数中的样式设置，如字体、颜色、对齐方式等。